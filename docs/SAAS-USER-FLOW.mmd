%% AutomateLanka SaaS Platform - Complete User Flow Diagram
%% Render with: https://mermaid.live/ or embed in docs

flowchart TD
    %% Entry Point
    A0([ğŸŒ Landing Page<br/>http://localhost:3000/]) --> A1{User Authenticated?}
    
    %% Guest Path
    A1 -- No --> B0[ğŸ§­ Explore Public Pages]
    B0 --> B1[View Homepage Stats<br/>â†’ GET /api/workflows/stats]
    B0 --> B2[AI-Powered Search Guest Mode<br/>â†’ /ai-search]
    B0 --> B3[Browse All Workflows<br/>â†’ /n8n-workflows]
    B3 --> B4[View Public Workflow Detail<br/>â†’ /api/workflows/:id]
    B4 --> B5[[â¬‡ï¸ Download Workflow JSON]]
    B0 --> B6[ğŸªª Register / Login CTA]
    B6 --> C0([ğŸ§¾ Sign Up Form])
    
    %% Authentication
    C0 --> C1[POST /api/auth/register]
    C1 --> C2[Backend creates:<br/>â€¢ user<br/>â€¢ default workspace<br/>â€¢ membership owner]
    C2 --> C3[Return JWT Tokens + workspace_id]
    C3 --> D0([ğŸ  Redirect to Dashboard])
    A1 -- Yes --> D0
    
    %% Authenticated Area
    D0 --> D1[ğŸ  Workspace Dashboard<br/>/w/:workspaceId/dashboard]
    D1 --> D2{User Action?}
    
    %% Smart Search Path
    D2 --> E0[ğŸ” AI Smart Search]
    E0 --> E1[User enters query<br/>Send Slack message when form submitted]
    E1 --> E2[GET /api/ai-search/semantic?q=...]
    E2 --> E3[Smart Search Service<br/>â†’ intent detection + FTS5 + scoring]
    E3 --> E4[[ğŸ§  Display Results<br/>Ranked list + match explanation]]
    E4 --> E5[User clicks a workflow]
    E5 --> E6[View Workflow Detail Page]
    E6 --> E7[[â¬‡ï¸ Download or â–¶ï¸ Run inside platform]]
    
    %% Browse Path
    D2 --> F0[ğŸ“š Browse Workflows]
    F0 --> F1[GET /api/workflows?workspace=:id]
    F1 --> F2[[ğŸ§¾ Filter / Sort / Paginate]]
    F2 --> F3[Click workflow â†’ View Details]
    F3 --> F4[[â¬‡ï¸ Download or â–¶ï¸ Run inside platform]]
    
    %% Create Workflow
    D2 --> G0[â• Create Workflow]
    G0 --> G1[Create Workflow Page<br/>/w/:workspaceId/workflows/new]
    G1 --> G2[Upload or design JSON]
    G2 --> G3[POST /api/workflows<br/>â†’ Store JSON + metadata]
    G3 --> G4[[âœ… Workflow saved<br/>Show editor view]]
    G4 --> G5[User clicks â–¶ï¸ Run]
    
    %% Run Workflow
    G5 --> R0[POST /api/workflows/:id/run]
    E7 --> R0
    F4 --> R0
    R0 --> R1[Backend creates run record]
    R1 --> R2[Queue Job â†’ Redis/Bull]
    R2 --> R3[Worker fetches & executes nodes]
    R3 --> R4[Update DB with run logs & status]
    R4 --> R5[[ğŸŸ¢ Run complete<br/>Show results in UI]]
    R5 --> R6[[ğŸ“œ Save run history<br/>/api/runs]]
    
    %% Integrations
    D2 --> J0[ğŸ”Œ Connect Integrations]
    J0 --> J1[Connect Slack / Gmail / HTTP]
    J1 --> J2[POST /api/integrations/:type/connect]
    J2 --> J3[OAuth / API key stored encrypted]
    J3 --> J4[[ğŸ”Œ Integration ready for workflows]]
    
    %% Membership
    D2 --> I0[ğŸ‘¥ Manage Members]
    I0 --> I1[Invite new member]
    I1 --> I2[POST /api/workspaces/:id/invite]
    I2 --> I3[Send invitation email]
    I3 --> I4[[ğŸ‘¤ Member joins workspace]]
    I4 --> I5[Membership role assigned]
    
    %% Billing
    D2 --> H0[ğŸ’³ Manage Billing]
    H0 --> H1[GET /api/billing/plans]
    H1 --> H2[User selects plan]
    H2 --> H3[POST /api/billing/subscribe â†’ Stripe Checkout]
    H3 --> H4[Stripe Webhook â†’ /api/billing/webhook]
    H4 --> H5[[ğŸ’³ Workspace plan updated]]
    H5 --> H6[Track usage<br/>/api/usage]
    
    %% Admin
    A0 --> Z0[ğŸ” Admin Portal internal]
    Z0 --> Z1[View system stats<br/>/api/admin/stats]
    Z1 --> Z2[Manage users / workflows / billing]
    
    %% Logout
    D1 --> L0[ğŸšª Logout]
    L0 --> L1[POST /api/auth/logout]
    L1 --> A0
    
    %% Styling
    classDef publicClass fill:#e1f5ff,stroke:#0288d1,stroke-width:2px
    classDef authClass fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef workspaceClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef actionClass fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef billingClass fill:#fff9c4,stroke:#f9a825,stroke-width:2px
    
    class B0,B1,B2,B3,B4,B5,B6 publicClass
    class C0,C1,C2,C3 authClass
    class D0,D1,D2,E0,F0,G0,H0,I0,J0 workspaceClass
    class R0,R1,R2,R3,R4,R5,R6 actionClass
    class H1,H2,H3,H4,H5,H6 billingClass

